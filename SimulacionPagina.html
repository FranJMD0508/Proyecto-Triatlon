<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación de Competencia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .tabla-container {
            margin: 20px 0;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table th, table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        table th {
            background-color: #4CAF50;
            color: white;
        }
        table td {
            background-color: #f9f9f9;
        }
        .btn {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .descalificado {
            color: red;
        }
        .finalizado {
            color: green;
        }
    </style>
</head>
<body>

    <h1>Simulación de Competencia</h1>
    <button class="btn" onclick="iniciarSimulacion()">Iniciar Simulación</button>

    <div class="tabla-container">
        <h2>Resultados Actuales</h2>
        <table id="tablaResultados">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Posición (km)</th>
                    <th>Disciplina</th>
                    <th>Tiempo</th>
                    <th>Estado</th>
                    <th>Hora de Llegada</th>
                </tr>
            </thead>
            <tbody>
                <!-- Aquí se generarán las filas de los participantes -->
            </tbody>
        </table>
    </div>

    <div class="tabla-container" id="tablaFinal">
        <h2>Posiciones Finales</h2>
        <table id="tablaPosicionesFinales">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Nombre</th>
                    <th>Posición (km)</th>
                    <th>Disciplina</th>
                    <th>Tiempo</th>
                    <th>Hora de Llegada</th>
                </tr>
            </thead>
            <tbody>
                <!-- Aquí se mostrarán las posiciones finales al terminar la simulación -->
            </tbody>
        </table>
    </div>

    <script>
        class Participante {
            constructor(nombre) {
                this.nombre = nombre;
                this.posicion = 0;
                this.descalificado = false;
                this.tiempo = 0;
                this.disciplina = "N/A";
                this.horaLlegada = null;
                this.variabilidadTiempo = Math.random() * (500 - 10) + 10; // Tiempo entre 10 y 500 segundos
            }

            ran(min, maximo) {
                return Math.random() * (maximo - min) + min;
            }

            avanzar(velocidadMax) {
                if (this.posicion < 50 && !this.descalificado) {
                    const distancia = this.ran(0.61, 0.8) * velocidadMax;
                    if (distancia < 1) {
                        this.descalificado = true;
                    } else {
                        this.posicion += distancia / 4;
                        this.actualizarTiempo(0);
                        if (this.posicion >= 50) {
                            this.posicion = 50;
                            this.disciplina = "Finalizado";
                            this.registrarLlegada();
                        }
                    }
                }
            }

            actualizarTiempo(incremento) {
                this.tiempo += incremento;
            }

            formatearTiempo() {
                const horas = Math.floor(this.tiempo / 3600);
                const minutos = Math.floor((this.tiempo % 3600) / 60);
                const segundos = Math.floor(this.tiempo % 60);
                return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
            }

            registrarLlegada() {
                if (!this.horaLlegada) {
                    this.horaLlegada = this.formatearTiempo();
                }
            }

            toString() {
                return `${this.nombre} - Posición: ${this.posicion.toFixed(2)} km - Disciplina: ${this.disciplina} - Tiempo: ${this.formatearTiempo()} - ${this.descalificado ? "Descalificado" : "En Competencia"} - Hora de llegada: ${this.horaLlegada || "N/A"}`;
            }
        }

        // Crear una lista de participantes
        const participantes = [
            new Participante("Alice"),
            new Participante("Bob"),
            new Participante("Charlie"),
            new Participante("Dana")
        ];

        function mostrarResultados() {
            const tablaResultados = document.getElementById("tablaResultados").getElementsByTagName("tbody")[0];
            tablaResultados.innerHTML = "";  // Limpiar la tabla

            participantes.sort((a, b) => b.posicion - a.posicion);
            participantes.forEach(participante => {
                const row = tablaResultados.insertRow();
                row.innerHTML = `
                    <td>${participante.nombre}</td>
                    <td>${participante.posicion.toFixed(2)}</td>
                    <td>${participante.disciplina}</td>
                    <td>${participante.formatearTiempo()}</td>
                    <td class="${participante.descalificado ? 'descalificado' : 'en-competencia'}">
                        ${participante.descalificado ? 'Descalificado' : 'En Competencia'}
                    </td>
                    <td>${participante.horaLlegada || "N/A"}</td>
                `;
            });
        }

        function iniciarSimulacion() {
            const velocidadCaminata = 7; // 7 km/h
            const velocidadNatacion = 1.72; // 1.72 m/s
            const velocidadCiclismo = 45; // 45 km/h

            let intervalo = setInterval(() => {
                let todosFinalizados = true;

                // Generar un solo incremento de tiempo aleatorio para todos los participantes
                const incrementoTiempo = Math.random() * (500 - 10) + 10;

                participantes.forEach(participante => {
                    participante.actualizarTiempo(incrementoTiempo);  // Incrementar tiempo de todos los participantes de forma sincronizada

                    if (!participante.descalificado && participante.posicion < 10) {
                        participante.avanzar(velocidadCaminata);
                        participante.disciplina = "Caminata";
                        todosFinalizados = false;
                    } else if (!participante.descalificado && participante.posicion < 20) {
                        participante.avanzar(velocidadNatacion);
                        participante.disciplina = "Natación";
                        todosFinalizados = false;
                    } else if (!participante.descalificado && participante.posicion < 50) {
                        participante.avanzar(velocidadCiclismo);
                        participante.disciplina = "Ciclismo";
                        todosFinalizados = false;
                    } else if (participante.posicion >= 50 && participante.disciplina !== "Finalizado") {
                        participante.posicion = 50;
                        participante.disciplina = "Finalizado";
                        participante.registrarLlegada();
                    }
                });

                mostrarResultados();

                // Si todos los participantes han finalizado, parar la simulación
                if (todosFinalizados) {
                    clearInterval(intervalo);
                    mostrarPosicionesFinales();
                }
            }, 1000); // Intervalo de 1 segundo
        }

        function mostrarPosicionesFinales() {
            const tablaFinal = document.getElementById("tablaPosicionesFinales").getElementsByTagName("tbody")[0];
            tablaFinal.innerHTML = ""; // Limpiar la tabla

            participantes.sort((a, b) => b.posicion - a.posicion);
            participantes.forEach((participante, index) => {
                const row = tablaFinal.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${participante.nombre}</td>
                    <td>${participante.posicion.toFixed(2)}</td>
                    <td>${participante.disciplina}</td>
                    <td>${participante.formatearTiempo()}</td>
                    <td>${participante.horaLlegada || "N/A"}</td>
                `;
            });

            document.getElementById("tablaFinal").style.display = "block";  // Mostrar la tabla de posiciones finales
        }
    </script>
</body>
</html>
